\chapter{El caso infinito}

% TODO: resumen del capítulo

\noindent
Sea $\vec{p} \in \R^n \setminus \braces{\vec{0}}$ un vector esencialmente entero y recordemos de la
Definición \ref{theory:def:rational} que tiene un único múltiplo coprimo $\vec{q} \in \Z^n$. Es
decir, existe un único escalar $m \in \R$ que satisface tres cosas: $\vec{p} = m\vec{q}$, las
entradas $q_1, \ldots, q_n$ son coprimas, y la primera entrada no nula $q_i$ es positiva. Al igual
que en el capítulo anterior, supondremos que $m$ es positivo. Equivalentemente, supondremos que la
primera entrada no nula $p_i$ es positiva\footnote{ El autor hace recordar que esta es una cuestión
	puramente de comodidad y no hay pérdida de generalidad. Cuando $m$ es negativo, los resultados
se mantienen pero es necesario voltear las desigualdades y cambiar las funciones piso por las
funciones techo, lo cual añadiría un número innecesario de casos a analizar.}.

Retomemos el entero $\eta \in \Z$ del Lema \ref{phase-1:lemma:eta} que parametriza la primera capa
entera que satisface el presupuesto \eqref{theory:constraint:budget}. A causa del Teorema
\ref{theory:th:feasibility} sabemos que si $q_i \leq 0$ para alguna $i \in \braces{1, \ldots, n}$,
entonces la $\eta$-ésima capa entera contiene un número infinito de puntos factibles. A partir de
esto último, somos capaces de resolver el automáticamente el problema de decisión de determinar si
un escalar $u^* \in \R$ es el valor óptimo del programa (\ref{theory:formulation}).
\begin{corollary}
	Supongamos que $q_i \leq 0$ para algún $i \in \braces{1, \ldots, n}$. Entonces el valor óptimo
	del programa lineal entero (\ref{theory:formulation}) es $m\eta$. Además, si $m$ es positivo,
	tenemos que $\eta$ es el múltiplo de $m$ más grande que satisface $m\eta \leq u$, donde $u$ es
	el lado derecho de la restricción presupuestaria \eqref{theory:constraint:budget}.
\end{corollary}
\begin{proof}
	Por el Teorema \ref{theory:th:feasibility} sabemos que existen una infinidad de soluciones en la
	$\eta$-ésima capa entera, así que sea $\vec{x}^*$ una de ellas. Entonces $\vec{q}^T\vec{x}^* =
	\eta$, pero $\vec{p} = m\vec{q}$ por la Definición \ref{theory:def:rational}, por lo que
	obtenemos $\vec{p}^T\vec{x}^* = m\vec{q}^T\vec{x}^* = m\eta$.

	Ahora bien, si $m$ es positivo, por el Lema \ref{phase-1:lemma:eta} tenemos que
	$\eta = \lfloor u/m \rfloor$
	. Supongamos que $\xi \in \Z$ satisface $m\xi \leq u$ y también $\lfloor
	u/m \rfloor < \xi$. Luego,
	\begin{equation*}
		m\left\lfloor \frac{u}{m} \right\rfloor < m\xi \leq u
		\implies \left\lfloor \frac{u}{m} \right\rfloor < \xi \leq \frac{u}{m},
	\end{equation*}
	pero esto contradice las propiedades de la función piso.
\end{proof}

\begin{observation}
	Para ilustrar la conveniencia de restringir $m$ a que sea positivo, consideremos el caso cuando
	$m < 0$. De una manera similar a la del Lema \ref{phase-1:lemma:eta}, podemos demostrar que
	$\eta \coloneq \lceil u/m \rceil$ parametriza también la primera capa entera que satisface el
	presupuesto, pues ahora tenemos de la restricción \eqref{theory:constraint:budget} que
	$\vec{p}^T\vec{x} \leq u$ si y solo si $\vec{q}^T\vec{x} \geq u/m$. Se sigue cumpliendo que el
	valor óptimo del problema \eqref{theory:formulation} es $m\eta$. Sin embargo, $\eta$ ahora es el
	múltiplo más chico de $m$ que satisface $m\eta \geq u$.
\end{observation}

Una vez resuelto el problema de decisión, podemos preguntarnos concretamente cómo obtener el punto
óptimo. Por el Teorema \ref{theory:th:feasibility} sabemos que debemos resolver la ecuación lineal
diofantina $\vec{q}^T\vec{x} = \eta$. Del Teorema \ref{th:lattice} sabemos que existen $k \in \Z$ y
$\vec{t} \in \Z^{n-1}$ tales que
\begin{equation*}
	\vec{x} = k\vec{\omega} + M\vec{t},
\end{equation*}
donde $\vec{\omega}$ y $M$ están definidas por \eqref{eq:vec-omega} y \eqref{eq:mat-T},
respectivamente. De los Lemas \ref{lemma:iso1} y \ref{lemma:iso2} sabemos que
\begin{equation*}
	\vec{q}^T\left(\eta\vec{\omega} + M\vec{t}\right) = \eta\vec{q}^T\vec{\omega} + \vec{q}^TM\vec{t} = \eta
\end{equation*}
para todo $\vec{t} \in \Z^{n-1}$. Así pues, debe ser el caso que $k = \eta$ y debemos encontrar
condiciones suficientes en $\vec{t}$ para asegurar la no-negatividad de $\vec{x}$. En primer lugar,
sabemos que para todo $i \in \braces{1, \ldots, n - 2}$, la entrada $t_i$ debe satisfacer
\eqref{eq:param-lb}. En segundo lugar, recuperamos de (\ref{eq:last-solution}) que las últimas dos
soluciones de la ecuación $\vec{q}^T\vec{x} = \eta$ están dadas por
\begin{equation}
	\begin{cases}
		x_{n-1} = \omega_{n-1}x_{n-1}' + \frac{q_n}{\prod_{j=1}^{n-1}g_j}t_{n-1}, \\
		x_n = \omega_{n-1}x_n' - \frac{q_{n-1}}{\prod_{j=1}^{n-1}g_j}t_{n-1},
	\end{cases}
\end{equation}
donde los enteros $g_i$ están definidos por \eqref{dummy:next-g} con $g_1 = 1$, $\omega_{n-1}$ está
definida a través de la relación de recurrencia \eqref{eq:omega-recurrence} con condición inicial
$\omega_1 = \eta$ (o bien a partir del Lema \ref{eq:omega-formula} con $k = \eta$), y $x_{n-1}',
x_n'$ son coeficientes de Bézout que satisfacen \eqref{eq:last-equation-bez}.

Para que se satisfagan las condiciones de no negatividad de $x_{n-1}$ y de $x_n$, encontramos que
$t_{n-1} \in \Z$ debe cumplir ciertas desigualdades según los signos de $q_{n-1}$ y de $q_n$.
Definamos, por conveniencia,
\begin{equation}
	\label{eq:lr-bounds}
	b_1 \coloneq -\frac{\omega_{n-1}x_{n-1}'}{q_n} \cdot \prod_{j=1}^{n-1}g_j, \quad
	b_2 \coloneq \frac{\omega_{n-1}x_{n}'}{q_{n-1}} \cdot \prod_{j=1}^{n-1}g_j.
\end{equation}
Entonces, para asegurar la no-negatividad de $x_{n - 1}$ y de $x_n$, debe ser el caso que
\begin{equation}
	\label{eq:feasible-param}
	t_{n-1} \in 
	\begin{cases}
		\big[ \lceil b_1 \rceil, \lfloor b_2 \rfloor \big] &  0 < q_{n-1}, q_n, \\[0.5em]
		\big[ \lceil b_2 \rceil, \lfloor b_1 \rfloor \big] &  q_{n-1}, q_n < 0, \\[0.5em]
		\big[ \lceil \max\lbrace b_1 ,  b_2 \rbrace \rceil, \infty \big) &  q_{n-1}
		< 0 < q_n, \\[0.5em]
		\big( -\infty, \lfloor \min\lbrace b_1, b_2\rbrace \rfloor \big] &  q_n < 0
		< q_{n-1}.
	\end{cases}
\end{equation}

\begin{lemma}
	\label{lemma:t-existence}
	Sea $\vec{p} \in \R$ un vector cuyas entradas son todas distintas de cero, y sea $\vec{q} \in
	\Z^n$ su múltiplo coprimo. Entonces existe un vector $\vec{t} \in \Z^{n-1}$ que satisface ambos
	\eqref{eq:param-lb} y \eqref{eq:feasible-param}.
\end{lemma}
\begin{proof}
	Tenemos cuatro casos, pero observemos que los dos en donde $q_{n - 1}$ y $q_n$
	tienen signo distinto no son difíciles: si $q_{n - 1} <0 < q_n$, entonces el vector
	$\vec{t} \in \Z^{n-1}$ dado por
	\begin{equation*}
		t_i \coloneq \begin{cases}
			\left\lceil -\frac{\omega_ix_i'}{g_{i + 1}} \right\rceil, & i < n - 1, \\[0.5em]
			\lceil \max\lbrace b_1, b_2 \rbrace \rceil, & i = n - 1,
		\end{cases}
	\end{equation*}
	satisface ambos (\ref{eq:param-lb}) y (\ref{eq:feasible-param}). El caso $q_n < 0 <
	q_{n - 1}$ es completamente similar.

	Consideremos el caso $q_{n - 1}, q_n < 0$. Como ninguna entrada de $\vec{p}$ es nula y el vector
	$\vec{q}$ es su múltiplo coprimo, se sigue de la Definición \ref{theory:def:rational} que $q_1 >
	0$. Podemos entonces permutar las entradas $q_1$ y $q_{n}$ para regresar al primer caso.

	Finalmente, consideremos el caso $0 < q_{n - 1}, q_n$. Podemos suponer sin pérdida de
	generalidad que $q_{n - 2} < 0$. En efecto, como $q_i < 0$ para alguna $i \in \braces{1, \ldots,
	n - 2}$, somos capaces permutar las entradas $i$ y $n - 2$ de
	$\vec{q}$. Observemos que
	\begin{align*}
		b_2 - 1 &\leq \lfloor b_2 \rfloor \leq b_2, \\
		b_1 &\leq \lceil b_1 \rceil \leq b_1 + 1.
	\end{align*}
	De donde obtenemos
	\begin{equation*}
		b_2 - b_1 - 2 \leq \lfloor b_2 \rfloor - \lceil b_1 \rceil \leq b_2 - b_1.
	\end{equation*}
	Así pues, para que el intervalo $[\lceil b_1 \rceil, \lfloor b_2 \rfloor]$ esté bien definido,
	es suficiente con mostrar que existe un escalar $\omega_{n - 1}$ que satisfaga $b_2 - b_1 \geq
	2$. De \eqref{eq:lr-bounds} tenemos
	\begin{equation}
		\label{proof:b-sub}
		b_2 - b_1 = \omega_{n - 1}\prod_{j = 1}^{n-1}g_j \cdot
			\left(\frac{x_{n-1}'}{q_n} + \frac{x_n'}{q_{n - 1}}\right)
	\end{equation}
	Pero $x_{n-1}'$ y $x_n'$ satisfacen \eqref{eq:last-equation-bez}, y entonces
	\begin{equation*}
		\frac{x_{n-1}'}{q_n} + \frac{x_n'}{q_{n - 1}} = \frac{1}{q_{n-1}q_n} \cdot \prod_{j =
		1}^{n-1}g_j.
	\end{equation*}
	Sustituyendo en (\ref{proof:b-sub}),
	\begin{equation*}
		b_2 - b_1 = \frac{\omega_{n-1}}{q_{n-1}q_n} \cdot \prod_{j=1}^{n-1}g_j^2,
	\end{equation*}
	por lo que $b_2 - b_1 \geq 2$ si y solo si
	\begin{equation}
		\label{proof:omega-sub}
		\omega_{n-1} \geq 2\frac{q_{n-1}q_n}{\prod_{j=1}^{n-1}g_j^2}.
	\end{equation}
	De (\ref{eq:recurrence}) sabemos que
	\begin{equation*}
		\omega_{n-1} = \omega_{n-2}\omega_{n-1}' -
		\frac{q_{n-2}}{\prod_{j=1}^{n-2}g_j}t_{n-2}.
	\end{equation*}
	Sustituyendo en (\ref{proof:omega-sub}), usando el hecho de que $q_{n-2} < 0$ y despejando
	$t_{n-2}$, encontramos que $\lceil b_2 \rceil - \lfloor b_1 \rfloor \geq 0$ si
	\begin{equation*}
		t_{n-2} \geq \frac{\omega_{n-2}\omega_{n-1}'}{q_{n-2}}\cdot\prod_{j=1}^{n-2}g_j
		- 2\frac{q_{n-1}q_n}{q_{n-2}g_{n-1}^2}\cdot
		\prod_{j=1}^{n-2}g_j^{-1}
	\end{equation*}
	Llamemos $c$ al lado derecho de esta desigualdad. Así pues, definimos el vector
	$\vec{t} \in \Z^{n-1}$ de manera que
	\begin{equation*}
		t_i \coloneq \begin{cases}
			\left\lceil -\frac{\omega_ix_i'}{q_i} \right\rceil, & i < n - 2, \\[0.5em]
			\left\lceil \max\left\lbrace -\frac{\omega_ix_i'}{q_i}, c \right\rbrace
			\right\rceil, & i = n -2, \\[0.5em]
			\lceil b_1 \rceil, & i = n - 1.
		\end{cases}
	\end{equation*}
	Se verifica que $\vec{t}$ satisface ambos (\ref{eq:param-lb}) y (\ref{eq:feasible-param}).
\end{proof}

En síntesis, por el Lema \ref{lemma:t-existence} sabemos que existe un vector
$\vec{t} \in \Z^{n-1}$ que satisface ambos (\ref{eq:param-lb}) y (\ref{eq:feasible-param}).
Al definir $\vec{x}^* \coloneq \eta\vec{\omega} + M\vec{t}$, entonces $\vec{x}$ es una solución no
negativa de $\vec{q}^T\vec{x} = \eta$. Por el Teorema \ref{theory:th:feasibility} se sigue que
$\vec{x}^*$ es el óptimo de (\ref{theory:formulation}).

En la práctica es mejor usar la relación de recurrencia (\ref{eq:recurrence}) y ``construir'' las
entradas $x_i$ al mismo tiempo que definimos $t_i$ de manera que satisfaga
(\ref{eq:param-lb}) y (\ref{eq:lr-bounds}). Si procedemos de esta forma no tenemos que encontrar primero
$\vec{\omega}$ y $M$, determinar $\vec{t}$ y luego recuperar $\vec{x}$. A partir de esto obtenemos
el siguiente resultado.
\begin{theorem}
	\label{infinite:th:complexity}
	El problema (\ref{theory:formulation}) se puede resolver a través de encontrar la solución de
	una ecuación lineal diofantina en $n$ incógnitas.
\end{theorem}

\section{Análisis de resultados}
\noindent
Una consecuencia del Teorema \ref{infinite:th:complexity} es que la complejidad algoritmítica del
problema (\ref{theory:formulation}) es lineal en la dimensión $n$ siempre y cuando $q_i < 0$
para alguna $i \in \lbrace 2, \ldots, n\rbrace$. En esta sección describimos un algoritmo cuyo
tiempo de terminación es $\mathcal{O}(n)$. A través de los resultados obtenidos previamente, somos
capaces de mostrar que nuestro algoritmo es correcto. Finalmente, implementamos nuestro algoritmo en
el lenguaje de programación Python y comparamos sus tiempos de terminación con los de la
implementación de Ramificación y Acotamiento en la librería PuLP. 
